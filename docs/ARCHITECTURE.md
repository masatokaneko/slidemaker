# アーキテクチャドキュメント

## システム概要

SlideMakerは、自然言語からPowerPointプレゼンテーションを生成するAIツールです。システムは以下の主要コンポーネントで構成されています：

1. フロントエンド（Next.js）
2. バックエンドAPI（Next.js API Routes）
3. データベース（PostgreSQL）
4. ファイルストレージ（ローカル/クラウド）

## コンポーネント構成

### フロントエンド

```
app/
├── components/     # 再利用可能なUIコンポーネント
├── contexts/       # Reactコンテキスト
├── hooks/          # カスタムフック
└── pages/          # ページコンポーネント
```

### バックエンド

```
lib/
├── powerpoint-generator.ts  # PowerPoint生成ロジック
├── chart-generator.ts      # チャート生成ロジック
├── pdf-analyzer.ts         # PDF分析ロジック
├── pattern-storage.ts      # デザインパターンストレージ
├── file-storage.ts         # ファイルストレージ
└── error-handler.ts        # エラーハンドリング
```

### データベース

```
prisma/
└── schema.prisma  # データベーススキーマ
```

## データフロー

1. プレゼンテーション生成
   ```
   ユーザー入力 → 自然言語処理 → スライド構造生成 → PowerPoint生成 → ファイル保存
   ```

2. PDF分析
   ```
   PDFアップロード → パターン抽出 → データベース保存 → プレゼンテーション適用
   ```

3. チャート生成
   ```
   データ入力 → チャート生成 → 画像変換 → スライド追加
   ```

## セキュリティ

1. 認証
   - NextAuth.jsによる認証
   - JWTトークンによるAPI認証

2. ファイル処理
   - ファイルタイプの検証
   - サイズ制限
   - ウイルススキャン

3. データ保護
   - 暗号化されたデータベース接続
   - セキュアなファイルストレージ
   - アクセス制御

## パフォーマンス

1. 最適化
   - 画像の最適化
   - チャートのキャッシュ
   - データベースのインデックス

2. スケーリング
   - 水平スケーリング
   - ロードバランシング
   - CDNの利用

## エラーハンドリング

1. エラーコード
   - カスタムエラーコード
   - エラーメッセージの多言語対応
   - エラーログの記録

2. リカバリー
   - 自動リトライ
   - フォールバック処理
   - エラー通知

## テスト戦略

1. 単体テスト
   - コンポーネントテスト
   - ユーティリティ関数テスト
   - エラーハンドリングテスト

2. 統合テスト
   - APIエンドポイントテスト
   - データベース操作テスト
   - ファイル処理テスト

3. E2Eテスト
   - ユーザーフローテスト
   - パフォーマンステスト
   - セキュリティテスト

## デプロイメント

1. 環境
   - 開発環境
   - ステージング環境
   - 本番環境

2. CI/CD
   - GitHub Actions
   - 自動テスト
   - 自動デプロイ

3. モニタリング
   - エラーログ
   - パフォーマンスメトリクス
   - ユーザー行動分析 